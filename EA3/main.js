let model = null;
let tokenizer = null;
const k = 5;

const options = {
    scales: {
        y: {
            beginAtZero: true,
            max: 0.25,
            ticks: {
                color: "#ffffff", // Y-Achsenbeschriftung (z. B. rot)
            },
        },
        x: {
            ticks: {
                color: "#ffffff", // X-Achsenbeschriftung (z. B. blau)
            },
        },
    },
    plugins: {
        legend: {
            labels: {
                color: "#ffffff", // Legendenbeschriftung
            },
        },
    },
};

const labels = [
    "wie",
    "ein",
    "bald",
    "die",
    "dorthin",
    "den",
    "eier",
    "sich",
    "ich",
    "sie",
    "man",
    "auch",
    "dass",
    "wenigstens",
    "ihren",
    "damit",
    "nicht",
    "es",
    "wo",
    "freilich",
];
const probabilities = [
    0.1962, 0.0982, 0.0665, 0.0616, 0.0512, 0.0464, 0.0286, 0.0235, 0.0187,
    0.0187, 0.0185, 0.0184, 0.0178, 0.0172, 0.0162, 0.0146, 0.0145, 0.0107,
    0.0097, 0.0096,
];
const loss_t1 = [
    7.336151599884033, 6.736197471618652, 6.256406784057617, 6.19721794128418,
    6.178915977478027, 6.160030364990234, 6.139481544494629, 6.114704608917236,
    6.089697360992432, 6.057744979858398, 6.031991481781006, 6.015211582183838,
    5.991083145141602, 5.962483882904053, 5.927804946899414, 5.851960182189941,
    5.775775909423828, 5.71143102645874, 5.6568145751953125, 5.606660842895508,
    5.548338890075684, 5.500364303588867, 5.432950019836426, 5.344439506530762,
    5.288929462432861, 5.208434581756592, 5.130771636962891, 5.048913478851318,
    4.972929954528809, 4.896247386932373, 4.798685073852539, 4.69160795211792,
    4.581582069396973, 4.479851245880127, 4.382347106933594, 4.282425403594971,
    4.17753791809082, 4.042486190795898, 3.941915512084961, 3.8395605087280273,
    3.6968159675598145, 3.5971789360046387, 3.4567437171936035,
    3.313328981399536, 3.198214292526245, 3.071139097213745, 2.9439830780029297,
    2.8360955715179443, 2.7097723484039307, 2.593780040740967,
    2.4968624114990234, 2.3793249130249023, 2.2663888931274414,
    2.156546115875244, 2.0596868991851807, 1.9608190059661865,
    1.8603732585906982, 1.7696248292922974, 1.6744757890701294,
    1.5911991596221924, 1.5117493867874146, 1.4319708347320557,
    1.3561736345291138, 1.3033770322799683, 1.2223526239395142,
    1.1796590089797974, 1.1087700128555298, 1.044915795326233,
    1.0059961080551147, 0.9471850395202637, 0.9057506918907166,
    0.8557898998260498, 0.8155294060707092, 0.7786591053009033,
    0.7420576214790344, 0.7035142779350281, 0.6706905961036682,
    0.6396156549453735, 0.613240122795105, 0.5899685621261597,
    0.5608344674110413, 0.5493338108062744, 0.5336685180664062,
    0.5231660008430481, 0.5069382786750793, 0.48472175002098083,
    0.46506771445274353, 0.43679720163345337, 0.4267381727695465,
    0.4126984179019928, 0.4051278531551361, 0.3929726779460907,
    0.38508933782577515, 0.3708246648311615, 0.3688183128833771,
    0.3603498935699463, 0.35807695984840393, 0.3520280122756958,
    0.340927392244339, 0.34196799993515015,
];
const loss_t2 = [
    6.72420597076416, 5.5746636390686035, 5.0827178955078125, 4.678539752960205,
    4.333456516265869, 4.044145584106445, 3.787442207336426, 3.556086540222168,
    3.353808879852295, 3.172438144683838, 3.0287022590637207,
    2.8854379653930664, 2.7641539573669434, 2.6510069370269775,
    2.5594353675842285, 2.468013286590576, 2.391777515411377,
    2.3229715824127197, 2.2517166137695312, 2.1851184368133545,
    2.133389711380005, 2.0839951038360596, 2.027174711227417,
    1.9953246116638184, 1.945921540260315, 1.903523564338684,
    1.8634384870529175, 1.8282287120819092, 1.7895307540893555,
    1.759081244468689, 1.736591100692749, 1.7015293836593628,
    1.6714637279510498, 1.6531380414962769, 1.6294227838516235,
    1.6094661951065063, 1.5874552726745605, 1.5600051879882812,
    1.5383658409118652, 1.5173619985580444, 1.498502492904663,
    1.476599931716919, 1.4599634408950806, 1.4447436332702637,
    1.425183892250061, 1.4116535186767578, 1.3882999420166016,
    1.372389316558838, 1.3723164796829224, 1.3554409742355347,
    1.3366204500198364, 1.3154778480529785, 1.3165183067321777,
    1.297088623046875, 1.2822716236114502, 1.2715153694152832,
    1.2621339559555054, 1.247972011566162, 1.2412606477737427,
    1.226585030555725, 1.2254339456558228, 1.2073720693588257,
    1.2080415487289429, 1.192108392715454, 1.180723786354065,
    1.1737343072891235, 1.1683026552200317, 1.1619153022766113,
    1.1440566778182983, 1.131104588508606, 1.1335538625717163,
    1.1320222616195679, 1.1145639419555664, 1.1173917055130005,
    1.1047649383544922, 1.0838017463684082, 1.0888131856918335,
    1.0870893001556396, 1.0761728286743164, 1.0660651922225952,
    1.0568480491638184, 1.044479489326477, 1.0490553379058838,
    1.0392006635665894, 1.0387892723083496, 1.0226939916610718,
    1.01811945438385, 1.0235382318496704, 1.0059089660644531, 1.00984525680542,
    1.0025537014007568, 0.9965994954109192, 0.9997161030769348,
    0.9934859871864319, 0.9814514517784119, 0.9836212396621704,
    0.9771835803985596, 0.9697109460830688, 0.9683770537376404,
    0.9632371068000793,
];
const loss_t3 = [
    6.828227519989014, 5.80189323425293, 5.360771656036377, 5.00724983215332,
    4.706940650939941, 4.445782661437988, 4.216410160064697, 4.02155876159668,
    3.8440024852752686, 3.695617914199829, 3.555546760559082,
    3.4310505390167236, 3.328068971633911, 3.229558229446411, 3.137526512145996,
    3.0615737438201904, 2.989407539367676, 2.923494577407837, 2.859050989151001,
    2.807969808578491, 2.7529170513153076, 2.702826499938965,
    2.6601154804229736, 2.6121890544891357, 2.5667002201080322,
    2.524362802505493, 2.4886817932128906, 2.456759214401245, 2.424755096435547,
    2.3908441066741943, 2.3624420166015625, 2.335196018218994,
    2.3036062717437744, 2.2722089290618896, 2.2497591972351074,
    2.221364974975586, 2.2108004093170166, 2.18282151222229, 2.1601617336273193,
    2.1413803100585938, 2.1299407482147217, 2.10903000831604,
    2.0750818252563477, 2.0674874782562256, 2.057309627532959,
    2.0368239879608154, 2.0210013389587402, 2.0067007541656494,
    1.9917950630187988, 1.9777638912200928, 1.9559293985366821,
    1.9431538581848145, 1.9425870180130005, 1.923040509223938,
    1.9038704633712769, 1.8912944793701172, 1.8747178316116333,
    1.8724443912506104, 1.860368251800537, 1.8507229089736938,
    1.8406285047531128, 1.8303745985031128, 1.8210179805755615,
    1.805832028388977, 1.7955443859100342, 1.7897359132766724,
    1.784761667251587, 1.7736575603485107, 1.7637938261032104,
    1.7539169788360596, 1.7480604648590088, 1.7401843070983887,
    1.7298530340194702, 1.7342147827148438, 1.7127457857131958,
    1.7087140083312988, 1.6993392705917358, 1.6893819570541382,
    1.6924827098846436, 1.6772061586380005, 1.6725775003433228,
    1.6697810888290405, 1.6633031368255615, 1.6548866033554077,
    1.6540358066558838, 1.638209581375122, 1.6382794380187988,
    1.635250449180603, 1.631229043006897, 1.6219910383224487, 1.611005425453186,
    1.6027870178222656, 1.6021660566329956, 1.6065598726272583,
    1.5951330661773682, 1.5921748876571655, 1.585081934928894,
    1.574568510055542, 1.5742772817611694, 1.578900694847107,
];
const loss_t4 = [
    6.645873069763184, 5.893497943878174, 5.493577003479004, 5.193230628967285,
    4.96148681640625, 4.783590316772461, 4.633829116821289, 4.520718574523926,
    4.412701606750488, 4.321836948394775, 4.245929718017578, 4.173391819000244,
    4.115954875946045, 4.052729606628418, 3.99711537361145, 3.9534425735473633,
    3.9082484245300293, 3.871770143508911, 3.8396849632263184,
    3.8006701469421387, 3.773085594177246, 3.7348694801330566,
    3.709825038909912, 3.6783015727996826, 3.6507935523986816,
    3.6366100311279297, 3.6117780208587646, 3.5940186977386475,
    3.570672035217285, 3.555063009262085, 3.535830020904541, 3.51688814163208,
    3.4960029125213623, 3.4874658584594727, 3.470768928527832,
    3.4562971591949463, 3.4509761333465576, 3.4374330043792725,
    3.42950439453125, 3.409428119659424, 3.3966917991638184, 3.3884432315826416,
    3.383199453353882, 3.376265287399292, 3.3592443466186523, 3.348320245742798,
    3.3365542888641357, 3.3303561210632324, 3.331610679626465,
    3.3181419372558594, 3.314603805541992, 3.2944998741149902,
    3.2866690158843994, 3.28277850151062, 3.266979932785034, 3.2719953060150146,
    3.254871368408203, 3.256291627883911, 3.258525848388672, 3.247335433959961,
    3.2363550662994385, 3.2291371822357178, 3.2300217151641846,
    3.2304582595825195, 3.2255730628967285, 3.2168326377868652,
    3.2128546237945557, 3.200946569442749, 3.197470188140869,
    3.1993935108184814, 3.193195104598999, 3.182666063308716, 3.184196710586548,
    3.183403491973877, 3.1745269298553467, 3.1684391498565674, 3.16874098777771,
    3.167146921157837, 3.159109354019165, 3.151073694229126, 3.152266263961792,
    3.154270648956299, 3.147517442703247, 3.147474527359009, 3.1462109088897705,
    3.136348009109497, 3.1308131217956543, 3.13344144821167, 3.1314117908477783,
    3.1241514682769775, 3.1188478469848633, 3.109267473220825,
    3.1223678588867188, 3.106916666030884, 3.106860399246216,
    3.1058621406555176, 3.1036131381988525, 3.1039011478424072,
    3.096611499786377, 3.102700710296631,
];
const acc_t1 = [
    0.040244970470666885, 0.04170311987400055, 0.04403616115450859,
    0.0475357249379158, 0.04403616115450859, 0.04695246368646622,
    0.0475357249379158, 0.0475357249379158, 0.0475357249379158,
    0.04491105303168297, 0.04491105303168297, 0.045785944908857346,
    0.0437445342540741, 0.04549431428313255, 0.04870224744081497,
    0.051326919347047806, 0.05511811003088951, 0.05511811003088951,
    0.05424322187900543, 0.05715952441096306, 0.060075823217630386,
    0.06153397634625435, 0.0632837563753128, 0.061242345720529556,
    0.06999125331640244, 0.06707494705915451, 0.07028288394212723,
    0.07261592149734497, 0.07874015718698502, 0.07990667968988419,
    0.08690580725669861, 0.08894721418619156, 0.09711286425590515,
    0.10352873057126999, 0.10965295881032944, 0.11577719449996948,
    0.12452610582113266, 0.1423155516386032, 0.1466899961233139,
    0.15689705312252045, 0.17643627524375916, 0.1988918036222458,
    0.2260134220123291, 0.24409449100494385, 0.27238261699676514,
    0.2965879440307617, 0.3371245265007019, 0.3531641960144043,
    0.4006999135017395, 0.42286381125450134, 0.4552347660064697,
    0.48585593700408936, 0.516477108001709, 0.5549722909927368,
    0.5680956840515137, 0.5972586870193481, 0.6319626569747925,
    0.6628754734992981, 0.6876640319824219, 0.7022455930709839,
    0.7331583499908447, 0.7401574850082397, 0.7634879350662231,
    0.7862350940704346, 0.8008165955543518, 0.815689742565155,
    0.8250218629837036, 0.8387284874916077, 0.8608924150466919,
    0.8734325170516968, 0.8821814060211182, 0.887722373008728,
    0.9058034420013428, 0.9110528230667114, 0.9174686670303345,
    0.9230096340179443, 0.93438321352005, 0.9387576580047607,
    0.9425488710403442, 0.9419655799865723, 0.9483814835548401,
    0.9489647150039673, 0.9512977600097656, 0.9562554955482483,
    0.9550889730453491, 0.9641295075416565, 0.9655876755714417,
    0.9687955975532532, 0.9711286425590515, 0.9717118740081787,
    0.9734616875648499, 0.9734616875648499, 0.9760863184928894,
    0.9766696095466614, 0.9763779640197754, 0.9772528409957886,
    0.9760863184928894, 0.9760863184928894, 0.9775444865226746,
    0.9781277775764465,
];

const acc_t2 = [
    0.056432124227285385, 0.09111584722995758, 0.1260838657617569,
    0.1687277853488922, 0.21719971299171448, 0.2729211151599884,
    0.3397299349308014, 0.39118692278862, 0.4321250915527344,
    0.4713574945926666, 0.49196872115135193, 0.5222459435462952,
    0.5397299528121948, 0.5511016249656677, 0.5687277913093567,
    0.5882018208503723, 0.5924662351608276, 0.6066808700561523,
    0.6164889931678772, 0.6260128021240234, 0.6328358054161072,
    0.6396588683128357, 0.650035560131073, 0.652025580406189,
    0.6571428775787354, 0.6679459810256958, 0.6769012212753296,
    0.6781805157661438, 0.6861407160758972, 0.6929637789726257,
    0.6861407160758972, 0.7019189596176147, 0.7031983137130737,
    0.7064676880836487, 0.709452748298645, 0.7063255310058594,
    0.7165600657463074, 0.7213930487632751, 0.7218194603919983,
    0.7312011122703552, 0.734044075012207, 0.732764720916748,
    0.7377398610115051, 0.7364605665206909, 0.7388770580291748,
    0.7417199611663818, 0.746268630027771, 0.7421464323997498,
    0.7489694356918335, 0.7539445757865906, 0.7526652216911316,
    0.7584932446479797, 0.7565032243728638, 0.7670220136642456,
    0.7648898363113403, 0.765174150466919, 0.7653163075447083,
    0.7675906419754028, 0.7734186053276062, 0.7748401165008545,
    0.7702913880348206, 0.7764037251472473, 0.7731343507766724,
    0.7759772539138794, 0.7789623141288757, 0.7856432199478149,
    0.7792466282844543, 0.7812366485595703, 0.7883440256118774,
    0.7867803573608398, 0.7847903370857239, 0.7820895314216614,
    0.7909026145935059, 0.7872068285942078, 0.789765477180481,
    0.793887734413147, 0.7918976545333862, 0.7950248718261719,
    0.7970149517059326, 0.7982942461967468, 0.8018479347229004,
    0.7975835204124451, 0.7992892861366272, 0.8009950518608093,
    0.7978678345680237, 0.8031272292137146, 0.8059701323509216,
    0.8029850721359253, 0.8149253726005554, 0.8076758980751038,
    0.8083866238594055, 0.8078180551528931, 0.8075337409973145,
    0.8022743463516235, 0.8149253726005554, 0.8154939413070679,
    0.8123667240142822, 0.8136460781097412, 0.8127931952476501,
    0.8157782554626465,
];
const acc_t3 = [
    0.04931192472577095, 0.07787739485502243, 0.10060466825962067,
    0.12812760472297668, 0.16701418161392212, 0.21559633314609528,
    0.2659507989883423, 0.3053586184978485, 0.34320268034935,
    0.37010008096694946, 0.3878231942653656, 0.40836113691329956,
    0.4251459538936615, 0.4391159415245056, 0.453919917345047,
    0.4660133421421051, 0.4745621383190155, 0.48988741636276245,
    0.49635112285614014, 0.50291907787323, 0.5135529637336731,
    0.5207464694976807, 0.5256463885307312, 0.5348206758499146,
    0.5422226786613464, 0.550875723361969, 0.5548373460769653,
    0.5647414326667786, 0.5616138577461243, 0.5691201090812683,
    0.5779816508293152, 0.5783986449241638, 0.5863219499588013,
    0.5905963182449341, 0.5917431116104126, 0.5939324498176575,
    0.601125955581665, 0.6049833297729492, 0.6070683598518372,
    0.6158257126808167, 0.6119682788848877, 0.6120725870132446,
    0.6215596199035645, 0.6198915839195251, 0.6233319640159607,
    0.6265637874603271, 0.6294829249382019, 0.6308382153511047,
    0.6309424638748169, 0.6362593770027161, 0.640742301940918,
    0.6378231644630432, 0.6401167511940002, 0.6465804576873779,
    0.6501250863075256, 0.6490825414657593, 0.6523144245147705,
    0.6535654664039612, 0.6571100950241089, 0.654920756816864,
    0.6564845442771912, 0.6604462265968323, 0.6582568883895874,
    0.6620100140571594, 0.661697268486023, 0.6629483103752136,
    0.668369472026825, 0.6658673882484436, 0.6687864661216736,
    0.6710800528526306, 0.6726438403129578, 0.6753544807434082,
    0.6757714748382568, 0.6732693910598755, 0.6772310137748718,
    0.6791076064109802, 0.6809841394424438, 0.6831734776496887,
    0.6837989687919617, 0.6837989687919617, 0.6859883069992065,
    0.683381974697113, 0.6843202710151672, 0.6860925555229187,
    0.6857798099517822, 0.6910967230796814, 0.6892201900482178,
    0.6895329356193542, 0.6890116930007935, 0.6894286870956421,
    0.6946413516998291, 0.6942243576049805, 0.6929733157157898,
    0.6905754804611206, 0.6981859803199768, 0.6972476840019226,
    0.6942243576049805, 0.7016263604164124, 0.6990200281143188,
    0.6951626539230347,
];
const acc_t4 = [
    0.05177036672830582, 0.07349604368209839, 0.09570299088954926,
    0.13358542323112488, 0.17662426829338074, 0.20302508771419525,
    0.23141972720623016, 0.2459951788187027, 0.26414573192596436,
    0.27603986859321594, 0.28848400712013245, 0.30092814564704895,
    0.311172217130661, 0.3226538300514221, 0.33317288756370544,
    0.3375730514526367, 0.3440357446670532, 0.34919214248657227,
    0.3537985384464264, 0.3632863461971283, 0.36610516905784607,
    0.3756617307662964, 0.3785493075847626, 0.38336196541786194,
    0.3892059028148651, 0.3920934796333313, 0.396631121635437,
    0.40020623803138733, 0.4034375846385956, 0.40728771686553955,
    0.40618768334388733, 0.41065657138824463, 0.41079407930374146,
    0.4144379496574402, 0.41780680418014526, 0.42268818616867065,
    0.4237882196903229, 0.42605704069137573, 0.42770710587501526,
    0.42818835377693176, 0.43210723996162415, 0.4333447813987732,
    0.4354073405265808, 0.43568235635757446, 0.4344448149204254,
    0.4413200318813324, 0.44152629375457764, 0.4422825574874878,
    0.4399449825286865, 0.44413885474205017, 0.4446888864040375,
    0.4512203335762024, 0.4501890540122986, 0.4518390893936157,
    0.45445168018341064, 0.4507390558719635, 0.4522516131401062,
    0.45754551887512207, 0.4532141387462616, 0.4546579420566559,
    0.45603299140930176, 0.45788928866386414, 0.45802679657936096,
    0.4573392868041992, 0.45898932218551636, 0.4576830267906189,
    0.46091437339782715, 0.4617394208908081, 0.4632519483566284,
    0.46297696232795715, 0.4625644385814667, 0.46600204706192017,
    0.4621519148349762, 0.4642832279205322, 0.4616706669330597,
    0.46641457080841064, 0.466139554977417, 0.4628394544124603,
    0.4677208364009857, 0.46847712993621826, 0.46943965554237366,
    0.4657270312309265, 0.47102096676826477, 0.46737709641456604,
    0.4671020805835724, 0.4715022146701813, 0.47280851006507874,
    0.46950840950012207, 0.4685458838939667, 0.46882086992263794,
    0.472121000289917, 0.47390854358673096, 0.4716397225856781,
    0.4761773645877838, 0.4750085771083832, 0.47246474027633667,
    0.47933995723724365, 0.4772086441516876, 0.4745960533618927,
    0.4762461185455322,
];

const epochs = loss_t1.map((_, i) => i + 1);

const loadModel = async () => {
    model = await tf.loadLayersModel("./model/lstm-lm.json");
    model.compile({
        optimizer: tf.train.adam(),
        loss: "meanSquaredError",
        metrics: ["accuracy"],
    });
};

const loadTokens = async () => {
    const response = await fetch("./model/vocab.json");
    tokenizer = await response.json(); // { "wort": index }
    return tokenizer;
};

const createChart = () => {
    new Chart(document.getElementById("barchartTestk20"), {
        type: "bar",
        data: {
            labels: labels,
            datasets: [
                {
                    label: "Wahrscheinlichkeit für nächstes Wort",
                    data: probabilities,
                    backgroundColor: "rgba(26, 126, 192, 1)",
                    borderColor: "rgba(54, 162, 235, 1)",
                    borderWidth: 1,
                },
            ],
        },
        options: options,
    });

    createLossChart("1", loss_t1);
    createLossChart("2", loss_t2);
    createLossChart("3", loss_t3);
    createLossChart("4", loss_t4);

    createAccChart("1", acc_t1);
    createAccChart("2", acc_t2);
    createAccChart("3", acc_t3);
    createAccChart("4", acc_t4);
};

const createAccChart = (number, acc_data) => {
    new Chart(document.getElementById("t" + number + "-acc"), {
        type: "line",
        data: {
            labels: epochs,
            datasets: [
                {
                    label: "Acc-Verlauf im " + number + ". Training",
                    data: acc_data,
                    backgroundColor: "rgba(26, 126, 192, 1)",
                    borderColor: "rgba(54, 162, 235, 1)",
                    tension: 0.3,
                    pointRadius: 0,
                },
            ],
        },
        options: {
            scales: {
                y: {
                    min: 0,
                    max: 1,
                    ticks: {
                        color: "#000000ff", // Y-Achsenbeschriftung (z. B. rot)
                    },
                },
                x: {
                    ticks: {
                        color: "#000000ff", // X-Achsenbeschriftung (z. B. blau)
                    },
                },
            },
            plugins: {
                legend: {
                    labels: {
                        color: "#000000ff", // Legendenbeschriftung
                    },
                },
            },
        },
    });
};

const createLossChart = (number, loss_data) => {
    new Chart(document.getElementById("t" + number + "-loss"), {
        type: "line",
        data: {
            labels: epochs,
            datasets: [
                {
                    label: "Loss-Verlauf im " + number + ". Training",
                    data: loss_data,
                    backgroundColor: "rgba(26, 126, 192, 1)",
                    borderColor: "rgba(54, 162, 235, 1)",
                    tension: 0.3,
                    pointRadius: 0,
                },
            ],
        },
        options: {
            scales: {
                y: {
                    min: 0,
                    max: 8,
                    ticks: {
                        color: "#000000ff", // Y-Achsenbeschriftung (z. B. rot)
                    },
                },
                x: {
                    ticks: {
                        color: "#000000ff", // X-Achsenbeschriftung (z. B. blau)
                    },
                },
            },
            plugins: {
                legend: {
                    labels: {
                        color: "#000000ff", // Legendenbeschriftung
                    },
                },
            },
        },
    });
};

const main = async () => {
    await loadModel();
    const tokenizer = await loadTokens();

    document.getElementById("genBtn").addEventListener("click", async () => {
        let textarea = document.getElementById("textarea");
        console.log(textarea.value);
    });

    const reverseTokenizer = Object.fromEntries(
        Object.entries(tokenizer.indexWord).map(([word, idx]) => [idx, word])
    );
    // 37, 2734, 2728, 694, 519
    const inputText = "die Mundöffnung und die damit"; //zusammenhängende
    const tokens = inputText.split(/\s+/); // sehr einfache Wortteilung

    const inputIndices = tokens.map(
        (t) => tokenizer.indexWord[t] ?? tokenizer.indexWord["<unk>"]
    );

    const maxLength = 6;
    const padded = [
        ...Array(maxLength - inputIndices.length).fill(0),
        ...inputIndices,
    ];

    const inputTensor = tf.tensor2d([padded]).cast("int32");

    const prediction = model.predict(inputTensor);
    const probabilities = prediction.arraySync()[0]; // JS-Array mit Wahrscheinlichkeiten

    // // Indizes 0...N in ein Array
    const allIndices = probabilities.map((_, i) => i);

    // // Sortiere nach Wahrscheinlichkeit absteigend
    const sorted = allIndices.sort(
        (a, b) => probabilities[b] - probabilities[a]
    );

    // // Nimm die Top-k Indizes
    const topK = sorted.slice(0, k);
    console.log(topK);
    console.log(tokenizer.indexWord[topK[0]]);

    // // Gib Ergebnis als Wort + Wahrscheinlichkeit zurück
    const topKWords = topK.map((index) => ({
        token: tokenizer.indexWord[index],
        probability: probabilities[index].toFixed(4),
    }));

    console.table(topKWords);
    createChart();
};

main();
